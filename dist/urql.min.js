"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=require("wonka"),t=require("graphql"),n=e(require("fast-json-stable-stringify")),o=e(require("graphql-tag")),i=require("react");function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var u=function(e,r){var t="";return void 0!==e?t="[Network] "+e.message:(void 0!==r&&r.forEach(function(e){t+="[GraphQL] "+e.message+"\n"}),t.trim())},c=function(e){return"string"==typeof e?new t.GraphQLError(e):"object"==typeof e&&e.message?new t.GraphQLError(e.message,e.nodes,e.source,e.positions,e.path,e.originalError,e.extensions||{}):e};function s(){return this.message}var p=function(e){function r(r){var t=r.networkError,n=r.response,o=(r.graphQLErrors||[]).map(c),i=u(t,o);e.call(this,i),this.name="CombinedError",this.message=i,this.graphQLErrors=o,this.networkError=t,this.response=n}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=s,r}(Error),f=function(e){for(var r=5381,t=0,n=0|e.length;t<n;t++)r=(r<<5)+r+e.charCodeAt(t);return r>>>0},d=Object.create(null);function v(e,r){return e+(void 0!==r.name?r.name.value:"")}var l=function(e,r){var o=function(e){if(void 0!==e.__key)return e.__key;var r=e.definitions.reduce(v,"");if("production"!==process.env.NODE_ENV&&""!==r){var n=t.print(e);r in d?d[r]!==n&&console.warn("Warning: Encountered multiple DocumentNodes with the same name."):d[r]=n}""===r&&(r=t.print(e));var o=f(r);return e.__key=o,o}(e);return null==r?o:f(""+o+n(r))},h=function(e,r){var t="string"==typeof e?o([e]):e;return{key:l(t,r),query:t,variables:r||{}}},y=function(e,r){if(void 0===r&&(r=[]),Array.isArray(e))e.forEach(function(e){return y(e,r)});else if("object"==typeof e&&null!==e)for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];"__typename"===t&&"string"==typeof n?r.push(n):"object"==typeof n&&null!==n&&y(n,r)}return r};function g(e,r,t){return t.indexOf(e)===r}var x=function(e){return y(e).filter(g)},m=function(e){return void 0!==e.selectionSet&&void 0!==e.selectionSet.selections&&a({},e,{selectionSet:a({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:"Field",name:{kind:"Name",value:"__typename"}}])})})},b=function(e){return t.visit(e,{Field:m,InlineFragment:m,OperationDefinition:m})},O=function(e){return r.make(function(t){var n,o,i=t[1],a=!1,u=r.pipe(e,r.onPush(t[0]),r.onEnd(i),r.subscribe(function(e){void 0===n?o=e:a||(n(e),i(),u())}))[0];if(void 0===o)throw new Promise(function(e){n=e});return function(){a=!0,u()}})},w=function(){},E=function(e){var r=e.operationName;return"subscription"!==r&&"query"!==r};function k(e){return""+e}var q=function(e){var r=e.error,t={data:e.data,error:void 0};return void 0!==r&&(t.error={networkError:""+r.networkError,graphQLErrors:r.graphQLErrors.map(k)}),t},S=function(e,r){var t=r.error,n={operation:e,data:r.data,error:void 0};return void 0!==t&&(n.error=new p({networkError:new Error(t.networkError),graphQLErrors:t.graphQLErrors})),n},N=function(e){var r=e.operationName;return"mutation"!==r&&"query"!==r};function C(e){return a({},e,{query:b(e.query)})}function P(e){return N(e)}var R=function(e){var t=e.forward,n=e.client,o=new Map,i=Object.create(null),a=C,u=_(o,i,n),c=M(o,i),s=function(e){var r=e.context.requestPolicy;return"query"===e.operationName&&"network-only"!==r&&("cache-only"===r||o.has(e.key))};function p(e){return!N(e)&&s(e)}function f(e){var r=e.context.requestPolicy,t=o.get(e.key);return"cache-and-network"===r&&j(n,e),void 0!==t?t:{operation:e,data:void 0,error:void 0}}function d(e){return!N(e)&&!s(e)}function v(e){e.operation&&"mutation"===e.operation.operationName?u(e):e.operation&&"query"===e.operation.operationName&&c(e)}return function(e){var n=r.share(e),o=r.pipe(n,r.filter(p),r.map(f)),i=r.pipe(r.merge([r.pipe(n,r.filter(d),r.map(a)),r.pipe(n,r.filter(P))]),t,r.tap(v));return r.merge([o,i])}},j=function(e,r){return e.reexecuteOperation(a({},r,{context:a({},r.context,{requestPolicy:"network-only"})}))},_=function(e,r,t){function n(r){if(e.has(r)){var n=e.get(r).operation;e.delete(r),j(t,n)}}return function(e){var t=new Set;function o(e){return t.add(e)}x(e.data).forEach(function(e){var t=r[e]||(r[e]=new Set);t.forEach(o),t.clear()}),t.forEach(n)}},M=function(e,r){return function(t){var n=t.operation.key;void 0!==t.data&&(e.set(n,t),x(t.data).forEach(function(e){(r[e]||(r[e]=new Set)).add(n)}))}},Q=function(e){return"subscription"===e.operationName};function D(e){return!Q(e)}function L(e){return console.log("[Exchange debug]: Incoming operation: ",e)}function A(e){return console.log("[Exchange debug]: Completed operation: ",e)}var U=function(e){var t=e.forward,n=new Set,o=function(e){var r=e.key,t=e.operationName;if("teardown"===t)return n.delete(r),!0;if("query"!==t)return!0;var o=n.has(r);return n.add(r),!o},i=function(e){n.delete(e.operation.key)};return function(e){var n=r.pipe(e,r.filter(o));return r.pipe(t(n),r.tap(i))}};function F(e){var r=e.operationName;return"query"===r||"mutation"===r}var W=function(e){var t=e.forward,n=F;function o(e){return!n(e)}return function(e){var i=r.share(e),a=r.pipe(i,r.filter(n),r.mergeMap(function(e){var t=e.key,n=r.pipe(i,r.filter(function(e){return"teardown"===e.operationName&&e.key===t}));return r.pipe(T(e),r.takeUntil(n))})),u=r.pipe(i,r.filter(o),t);return r.merge([a,u])}},T=function(e){if("subscription"===e.operationName)throw new Error("Received a subscription operation in the httpExchange. You are probably trying to create a subscription. Have you added a subscriptionExchange?");return r.make(function(r){var n=r[0],o=r[1],i="undefined"!=typeof AbortController?new AbortController:void 0,u=e.context,c="function"==typeof u.fetchOptions?u.fetchOptions():u.fetchOptions||{};function s(e){void 0!==e&&n(e),o()}if(c.then&&"function"==typeof c.then)c.then(function(r){var n=a({body:JSON.stringify({query:t.print(e.query),variables:e.variables}),method:"POST"},r,{headers:a({"content-type":"application/json"},r.headers),signal:void 0!==i?i.signal:void 0});$(e,n).then(s)});else{var p=a({body:JSON.stringify({query:t.print(e.query),variables:e.variables}),method:"POST"},c,{headers:a({"content-type":"application/json"},c.headers),signal:void 0!==i?i.signal:void 0});$(e,p).then(function(e){void 0!==e&&n(e),o()})}return function(){void 0!==i&&i.abort()}})},$=function(e,r){var t;return fetch(e.context.url,r).then(function(e){return G(r.redirect,t=e),t.json()}).then(function(r){return{operation:e,data:r.data,error:Array.isArray(r.errors)?new p({graphQLErrors:r.errors,response:t}):void 0}}).catch(function(r){if("AbortError"!==r.name)return{operation:e,data:void 0,error:new p({networkError:r,response:t})}})},G=function(e,r){if(void 0===e&&(e="follow"),r.status<200||r.status>("manual"===e?400:300))throw new Error(r.statusText)};function I(e){var r=e.operationName;"teardown"!==r&&"production"!==process.env.NODE_ENV&&console.warn('No exchange has handled operations of type "'+r+"\". Check whether you've added an exchange responsible for these operations.")}function J(){return!1}var V=function(e){return r.pipe(e,r.tap(I),r.filter(J))},H=function(e){return 1===e.length?e[0]:function(r){var t=r.client;return e.reduceRight(function(e,r){return r({client:t,forward:e})},r.forward)}},K=[U,R,W],Y=function(e){return new z(e)},z=function(e){var t=this;this.activeOperations=Object.create(null),this.createOperationContext=function(e){var r=(e||{}).requestPolicy;return void 0===r&&(r="cache-first"),a({url:t.url,fetchOptions:t.fetchOptions},e,{requestPolicy:r})},this.createRequestOperation=function(e,r,n){return{key:r.key,query:r.query,variables:r.variables,operationName:e,context:t.createOperationContext(n)}},this.reexecuteOperation=function(e){(t.activeOperations[e.key]||0)>0&&t.dispatchOperation(e)},this.executeQuery=function(e,r){var n=t.createRequestOperation("query",e,r);return t.executeRequestOperation(n)},this.executeSubscription=function(e,r){var n=t.createRequestOperation("subscription",e,r);return t.executeRequestOperation(n)},this.executeMutation=function(e,r){var n=t.createRequestOperation("mutation",e,r);return t.executeRequestOperation(n)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.suspense=!!e.suspense;var n=r.makeSubject(),o=n[1];this.operations$=n[0],this.dispatchOperation=o,this.exchange=H(void 0!==e.exchanges?e.exchanges:K),this.results$=r.share(this.exchange({client:this,forward:V})(this.operations$))};z.prototype.onOperationStart=function(e){var r=e.key;this.activeOperations[r]=(this.activeOperations[r]||0)+1,this.dispatchOperation(e)},z.prototype.onOperationEnd=function(e){var r=e.key,t=this.activeOperations[r]||0;(this.activeOperations[r]=t<=0?0:t-1)<=0&&this.dispatchOperation(a({},e,{operationName:"teardown"}))},z.prototype.executeRequestOperation=function(e){var t=this,n=e.key,o=e.operationName,i=r.pipe(this.results$,r.filter(function(e){return e.operation.key===n}));if("mutation"===o)return r.pipe(i,r.onStart(function(){return t.dispatchOperation(e)}),r.take(1));var a=r.pipe(i,r.onStart(function(){return t.onOperationStart(e)}),r.onEnd(function(){return t.onOperationEnd(e)}));return this.suspense?O(a):a};var B,X=Y({url:"/graphql"}),Z=i.createContext(X),ee=Z.Provider,re=Z.Consumer,te=function(e){var r=i.useRef(!1),t=i.useRef(a({},e)),n=i.useState(t.current),o=n[0],u=n[1],c=i.useCallback(function(e){if(r.current)u(e);else if("function"==typeof e){var n=e(t.current);a(t.current,n)}else u(function(){return a(t.current,e)})},[]);function s(){r.current=!1}return i.useEffect(function(){return r.current=!0,s},[]),[o,c]},ne=function(e){var t=i.useContext(Z),n=te({fetching:!1,error:void 0,data:void 0}),o=n[1];function a(e){return o({fetching:!1,data:e.data,error:e.error}),e}return[n[0],i.useCallback(function(n){o({fetching:!0,error:void 0,data:void 0});var i=h(e,n);return r.pipe(t.executeMutation(i),r.toPromise).then(a)},[t,e,o])]},oe=function(e,r){var t=i.useRef(void 0);return i.useMemo(function(){var n=h(e,r);return void 0!==t.current&&t.current.key===n.key?t.current:(t.current=n,n)},[e,r])};function ie(e){return a({},e,{fetching:!0})}function ae(e){return a({},e,{fetching:!1})}!function(e){e[e.WillMount=0]="WillMount",e[e.DidMount=1]="DidMount",e[e.Update=2]="Update"}(B||(B={}));var ue=function(e){var t=i.useRef(w),n=i.useContext(Z),o=te({fetching:!1,data:void 0,error:void 0}),u=o[0],c=o[1],s=oe(e.query,e.variables);function p(e){c({fetching:!1,data:e.data,error:e.error})}var f=i.useCallback(function(o){var i;t.current(),c(ie),i=r.pipe(n.executeQuery(s,a({requestPolicy:e.requestPolicy},o)),r.subscribe(p)),t.current=i[0]},[e.requestPolicy,n,s,c]);function d(){return t.current()}return function(e,r){var t=i.useRef(void 0),n=i.useRef(B.WillMount);n.current===B.WillMount&&(n.current=B.DidMount,t.current=e()),i.useEffect(function(){return n.current===B.Update?t.current=e():(n.current=B.Update,t.current)},r)}(function(){return e.pause?(t.current(),c(ae)):(f(),d)},[f,e.pause,c]),[u,f]},ce=function(e,t){var n=i.useRef(w),o=i.useContext(Z),a=te({fetching:!0,error:void 0,data:void 0}),u=a[0],c=a[1],s=oe(e.query,e.variables);function p(e){var r=e.data,n=e.error;c(function(e){return{fetching:!0,data:void 0!==t?t(e.data,r):r,error:n}})}var f=i.useCallback(function(){var e;n.current(),e=r.pipe(o.executeSubscription(s),r.subscribe(p)),n.current=e[0]},[o,t,s,c]);function d(){return n.current()}return i.useEffect(function(){return f(),d},[f]),[u]};function se(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&(t[n[o]]=e[n[o]])}return t}exports.Client=z,exports.CombinedError=p,exports.Consumer=re,exports.Context=Z,exports.Mutation=function(e){var r=e.children,t=ne(e.query);return r(a({},t[0],{executeMutation:t[1]}))},exports.Provider=ee,exports.Query=function(e){var r=e.children,t=se(e,["children"]),n=ue(t);return r(a({},n[0],{executeQuery:n[1]}))},exports.Subscription=function(e){var r=e.children,t=e.handler,n=se(e,["children","handler"]);return r(ce(n,t)[0])},exports.cacheExchange=R,exports.collectTypesFromResponse=x,exports.composeExchanges=H,exports.createClient=Y,exports.createRequest=h,exports.debugExchange=function(e){var t=e.forward;return function(e){return r.pipe(e,r.tap(L),t,r.tap(A))}},exports.dedupExchange=U,exports.defaultExchanges=K,exports.fallbackExchangeIO=V,exports.fetchExchange=W,exports.formatDocument=b,exports.getKeyForRequest=l,exports.noop=w,exports.ssrExchange=function(e){var t={},n=function(e){return!E(e)&&void 0!==t[e.key]};function o(e){return!n(e)}function i(e){return n(e)}function u(e){return S(e,t[e.key])}function c(e){var r=e.operation;if(!E(r)){var n=q(e);t[r.key]=n}}function s(e){delete t[e.operation.key]}var p=function(e){var t=e.client,n=e.forward;return function(e){var a=r.share(e),p=r.pipe(a,r.filter(o),n),f=r.pipe(a,r.filter(i),r.map(u));return t.suspense?p=r.pipe(p,r.tap(c)):f=r.pipe(f,r.tap(s)),r.merge([p,f])}};return p.restoreData=function(e){return a(t,e)},p.extractData=function(){return a({},t)},e&&e.initialState&&p.restoreData(e.initialState),p},exports.subscriptionExchange=function(e){var n=e.forwardSubscription;function o(e){var o=n({key:e.key.toString(36),query:t.print(e.query),variables:e.variables,context:a({},e.context)});return r.make(function(r){var t=r[0],n=o.subscribe({next:function(r){return t({operation:e,data:r.data||void 0,error:Array.isArray(r.errors)?new p({graphQLErrors:r.errors,response:void 0}):void 0})},error:function(r){return t({operation:e,data:void 0,error:new p({networkError:r,response:void 0})})},complete:r[1]});return function(){return n.unsubscribe()}})}return function(e){var t=e.forward,n=o;return function(e){var o=r.share(e),i=r.pipe(o,r.filter(Q),r.mergeMap(function(e){var t=e.key,i=r.pipe(o,r.filter(function(e){return"teardown"===e.operationName&&e.key===t}));return r.pipe(n(e),r.takeUntil(i))})),a=r.pipe(o,r.filter(D),t);return r.merge([i,a])}}},exports.toSuspenseSource=O,exports.useMutation=ne,exports.useQuery=ue,exports.useSubscription=ce;
//# sourceMappingURL=urql.min.js.map
